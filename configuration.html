<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Mar 27, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>99soft :: Rocoto - Home</title>
    <link rel="stylesheet" href="./css/maven-theme.css" type="text/css" />
    <link rel="stylesheet" href="./css/maven-base.css" type="text/css"/>
    <link rel="stylesheet" href="./css/prettify.css" type="text/css"/>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <script type="text/javascript" src="./js/prettify.js"></script>
    <script type="text/javascript" src="./js/niftycube.js"></script>
    <script type="text/javascript">
        window.onload=function() {
            Nifty("div\#wrapper", "big");
            Nifty("div#breadcrumbs", "small");
            Nifty("div\#navcolumn", "small");
            Nifty("div.source", "medium");
            prettyPrint();
        }
    </script>
      <meta name="author" content="Simple Configuration" />
    <meta name="Date-Revision-yyyymmdd" content="20110327" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="wrapper">
    <div id="banner">
                                      <a href="index.html" id="bannerLeft">
                                                <img src="images/logo.png" alt="Add some spice to Google Guice through configuration files!" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                
                <div class="xleft">
        <span id="publishDate">Last Published: 27 March 2011</span>
                  &nbsp;| <span id="projectVersion">Version: 5.0.1</span>
                      </div>
            <div class="xright">                    <a href="../../../" title="99soft">99soft</a>
              
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                
                                <h5>99soft :: Rocoto</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Home">Home</a>
            </li>
                  <li class="none">
            <strong>Configuration</strong>
          </li>
                  <li class="none">
                          <a href="converters.html" title="Converters">Converters</a>
            </li>
          </ul>
                       <h5>External Links</h5>
                  <ul>
                  <li class="none">
                          <a href="https://github.com/99soft/Rocoto" class="externalLink" title="Project Page">Project Page</a>
            </li>
                  <li class="none">
                          <a href="http://code.google.com/p/google-guice/" class="externalLink" title="Google Guice">Google Guice</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                          <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                       <h5>99soft</h5>
                  <ul>
                  <li class="none">
                          <a href="http://99soft.github.com/" class="externalLink" title="Home">Home</a>
            </li>
                                                                    <li class="collapsed">
                          <a href="http://99soft.github.com/maven.html" class="externalLink" title="Apache Maven Plugins">Apache Maven Plugins</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="http://99soft.github.com/commons.html" class="externalLink" title="Common tools">Common tools</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="http://99soft.github.com/guice.html" class="externalLink" title="Google Guice Integrations">Google Guice Integrations</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="http://99soft.github.com/semweb.html" class="externalLink" title="Semantic Web">Semantic Web</a>
                  </li>
          </ul>
                       <h5>General Information</h5>
                  <ul>
                  <li class="none">
                          <a href="http://99soft.github.com/volunteering.html" class="externalLink" title="Volunteering">Volunteering</a>
            </li>
                  <li class="none">
                          <a href="http://99soft.github.com/patches.html" class="externalLink" title="Contributing Patches">Contributing Patches</a>
            </li>
                  <li class="none">
                          <a href="http://99soft.github.com/getinvolved.html" class="externalLink" title="Get Involved">Get Involved</a>
            </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <!--  --><!-- Copyright 2009-2011 The 99 Software Foundation --><!--  --><!-- Licensed under the Apache License, Version 2.0 (the "License"); --><!-- you may not use this file except in compliance with the License. --><!-- You may obtain a copy of the License at --><!--  --><!-- http://www.apache.org/licenses/LICENSE-2.0 --><!--  --><!-- Unless required by applicable law or agreed to in writing, software --><!-- distributed under the License is distributed on an "AS IS" BASIS, --><!-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. --><!-- See the License for the specific language governing permissions and --><!-- limitations under the License. --><!--  --><div class="section"><h2>The Configuration module<a name="The_Configuration_module"></a></h2><p>The <i>ConfigurationModule</i> is a dependencies-less but open to support 3rd party libraries, lightweight yet powerful <i>Guice</i> module to easy load configurations and bind them to the <i>Guice Binder</i>.</p><p>With this tool users are now ready to load properties files, creating and configuring the module:</p><div class="source"><pre>import com.google.inject.Guice;
import com.google.inject.Injector;

import com.googlecode.rocoto.configuration.ConfigurationModule;

...

Injector injector = Guice.createInjector(new ConfigurationModule() {

        @Override
        protected void bindConfigurations() {
            bindEnvironmentVariables();
            bindSystemProperties();

            bindProperties(URI.create(&quot;classpath:/org/nnsoft/guice/rocoto/configuration/ldap.properties&quot;));
            bindProperties(&quot;proxy.xml&quot;).inXMLFormat();

            File parentConf = new File(&quot;src/test/data/org/nnsoft&quot;);
            bindProperties(new File(parentConf, &quot;ibatis.properties&quot;));
            bindProperties(new File(parentConf, &quot;guice/jdbc.properties&quot;));
            bindProperties(new File(parentConf, &quot;guice/rocoto/configuration/memcached.xml&quot;)).inXMLFormat();

            bindProperty(&quot;JDBC.url&quot;).toValue(&quot;jdbc:mysql://${JDBC.host|localhost}:${JDBC.port}/${JDBC.schema}&quot;);
        }

    },
    ...
);</pre></div><p>Now users can access to configuration parameters through the <tt>@com.google.inject.name.Named</tt> annotation.</p><p><b>NOTE</b> Environment Variables will be referred with the <tt>env.</tt> prefix.</p><div class="section"><h3>Implementing your own configuration loader<a name="Implementing_your_own_configuration_loader"></a></h3><p>If users want to load configuration files in different format, all they have to do is implementing the Iterable&lt;Entry&lt;String, String&gt;&gt; or Iterator&lt;Entry&lt;String, String&gt;&gt; interfaces:</p><div class="source"><pre>class INIReader implements Iterable&lt;Entry&lt;String, String&gt;&gt; {

    /**
     * {@inheritDoc}
     */
    public Iterator&lt;Entry&lt;String, String&gt;&gt; iterator() throws Exception {
        return // next INI configuration entry
    }

}</pre></div><p>then bind it:</p><div class="source"><pre>new ConfigurationModule() {

    @Override
    protected void bindConfigurations() {
        bindProperties(new INIReader(&quot;whenever/jdbc.ini&quot;));
    }

}</pre></div></div><div class="section"><h3>${}, the <i>Apache Ant</i> variables style<a name="a_the_Apache_Ant_variables_style"></a></h3><p>The <tt>com.googlecode.rocoto.configuration.ConfigurationModule</tt> supports the well known <i>${}</i> expression to define placeholders, which scope is the whole configuration, that means that users can define some commons properties in one properties file:</p><div class="source"><pre>commons.host=localhost
commons.port=8080
...</pre></div><p>then referencing them in different files:</p><div class="source"><pre>ldap.host=${commons.host}
ldap.port=${commons.port}
...</pre></div><p>it works also in the XML format:</p><div class="source"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;
&lt;properties version=&quot;1.0&quot;&gt;
    &lt;entry key=&quot;proxy.host&quot;&gt;${commons.host}&lt;/entry&gt;
    &lt;entry key=&quot;proxy.port&quot;&gt;${commons.port}&lt;/entry&gt;
    ...
&lt;/properties&gt;</pre></div><div class="section"><h4>Default Values<a name="Default_Values"></a></h4><p>In Java code users can retrieve a property from <tt>java.util.Properties</tt> specifying the <b>default</b> value if the input key is not present, using the <a class="externalLink" href="http://download.oracle.com/javase/6/docs/api/java/util/Properties.html#getProperty(java.lang.String, java.lang.String)">Properties#getProperty(java.lang.String, java.lang.String)</a> method.</p><p>Rocoto allows doing the same, users can specify a key using the pipe character <tt>|</tt> to separate the key name from the default value:</p><div class="source"><pre>JDBC.url=jdbc:derby://${JDBC.host|localhost}:${JDBC.port|1527}/${JDBC.schema}</pre></div><p>that means if <tt>JDBC.host</tt> and <tt>JDBC.port</tt> won't be specified, they will be replaced by the default values; given the following properties:</p><div class="source"><pre>JDBC.url=jdbc:derby://${JDBC.host|localhost}:${JDBC.port|1527}/${JDBC.schema}
JDBC.schema=rocoto</pre></div><p>the <tt>JDBC.url</tt> property value will be <tt>jdbc:derby://localhost:1527/rocoto</tt>.</p></div><div class="section"><h4>com.google.inject.name.Names compatibility<a name="com.google.inject.name.Names_compatibility"></a></h4><p>Users can still load properties using the Google Guice <a class="externalLink" href="http://google-guice.googlecode.com/svn/trunk/javadoc/com/google/inject/name/Names.html">Names</a> but take care that loading properties using this method <i>${}</i> expressions won't be resolved at all. On the other side, specified properties in that way will be used to resolve <i>${}</i> expressions in properties using the <tt>ConfigurationModule</tt>.</p></div></div><div class="section"><h3>More flexible than the Spring Framework!<a name="More_flexible_than_the_Spring_Framework"></a></h3><p>I had a not so good experience with the Spring's <a class="externalLink" href="http://static.springsource.org/spring/docs/2.0.2/api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html">PropertyPlaceholderConfigurer</a> because it forces users to centralize the properties files loading; I mean, to make things working, in the way that <i>${}</i> expressions were correctly resolved, I had to declare just one <tt>PropertyPlaceholderConfigurer</tt> for the whole context, list all the <tt>*.properties</tt> files for the all modules.</p><p>I didn't like that approach at all, it doesn't allow users to split configurations in different modules even if some keys are shared by two or more modules. Rocoto users won't have these problems at all, they can load <tt>*.properties</tt> files from different locations and obtain the same result.</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">Copyright &#169;                    2010-2011
                        <a href="http://www.99soft.org/">99 Software Foundation</a>.
            All Rights Reserved.      
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    </div>
  </body>
</html>
